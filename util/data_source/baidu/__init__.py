import subprocess
import json
from typing import Tuple, List
import requests
import re
from bs4 import BeautifulSoup
# from util.data_source.validator import baidu_population_validor, baidu_gdp_validor
from util.data_source.dto import GDPItem, PopulationItem
from util.data_source.baidu.parser import parse_gdp_html, parse_population_html
from util.data_source.parser import population_unit_parser, year_parser, gdp_unit_parser
from util.area_util import Area
from util.log import logger
from urllib import parse

'''
baidu url tips
    1. url没关系，重点是cookies。可以尝试用session保存下来cookies
'''


def _get2(word: str) -> Tuple[str, str]:
    '''
        return resp_content, err_str
    '''
    headers = {
        'Host': 'www.baidu.com',
        'User-agent': 'Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Mobile Safari/537.36',
        'Cookie': 'wpr=0; BDICON=10294984.98; PSTM=1592374173; BIDUPSID=D06D2C138A5A78CF4992B441994D1787; __yjs_duid=1_c333b26cef54dd06de9d1a50e67d017e1620725024700; BD_UPN=123253; BAIDUID=C8AFED5ABC397F518A007AC7F65D5635:SL=0:NR=10:FG=1; BDSFRCVID=qC0OJeC62rhqUQRDg6eXqa0DFbOuS-JTH6f3RImXqHw54sMDrKcmEG0PQx8g0K4Moys6ogKK0mOTHv-F_2uxOjjg8UtVJeC6EG0Ptf8g0f5; H_BDCLCKID_SF=tJufoCLXtCvbfP0k2-Otq4tHeN7W-URZ56bHWh0MalvrflbVQ4RKKtoQQ-DHBMnQJKrnKUT13Rr8jCOC2l3F-R_F3xb4Qx643bRTLU7GHRvKfj6S5xTmhP-UyN3LWh37Je3lMKoaMp78jR093JO4y4Ldj4oxJpOJ5JbMopCafD_KMIDCejL3-RJH-xQ0KnLXKKOLVbcgJp7ketn4hUt2hfPm54OA0qOn-CCjKpL-WhvSMno2QhrdQf4WWb3ebTJr32Qr-JONLlrpsIJM5hnlqtPX5ec7-f6TaKviaKJEBMb1MlvDBT5h2M4qMxtOLR3pWDTm_q5TtUJMeCnTDMFhe6jXjNLqq6_sKjAX3JjV5PK_Hn7zen7m5M4pbq7H2M-jam3dLqbmLUjNqJDxQMDKyUPjjU5n0pcr3mOfhUJb-IOdspcs34bp0fCkQN3T-pRPHC3HL66dbqrmDn3oyT3VXp0nj4Rly5jtMgOBBJ0yQ4b4OR5JjxonDh83bG7MJUutfJuH_KDKfCD3H48k-4QEbbQH-UnLq-Rw22OZ04n-ah02Dqv35xOx0h_7KfLj0UKHW23Q_bom3UTdsq76Wh35K5tTQP6rLtJ4Lmo4KKJxbU7lKJv45Dc15xCrhUJiB5OLBan7_qvIXKohJh7FM4tW3J0ZyxomtfQxtNRJ0DnjtpChbC8GD68bD5OBeU_XhPcKaKbyWJ3b2PK_Hn7zenQTDM4pbt-qJJj3-GTIbqbjJJ5iqJDxQMjDXnL9qt6nBT5htarAWxnhWP0hM-OEQb5v-PukQN3TQRkO5bRi_p6OM48-Dn3oyT3VXp0n5mcly5jtMgOBBJ0yQ4b4OR5JjxonDh83bG7MJPKtfD7H3KC-tKDMhfK; BCLID_BFESS=8834056595211287241; BDORZ=B490B5EBF6F3CD402E515D22BCDA1598; kleck=45a27e82d3a5f7fd850852b25e8a120b; H_WISE_SIDS=107314_110085_131862_176399_180636_188748_196428_204902_208721_209568_210305_210323_211433_211985_212296_212740_212869_213044_213351_214793_215730_216770_216846_217167_217439_218458_218549_218597_219451_219558_219723_219889_219942_219946_220071_220315_220334_220345_220386_220603_220663_221007_221016_221119_221120_221370_221410_221501_221698_221798_221825_221872_221923_222002_222136_222272_222298_222352_222389_222397_222522_222528_222616_222617_222619_222778_222780_222844_222861_223042_223064_223111_223138_223220_223238_223253_223296_223477_223596_223672_223729_223768_223780_223783_223826_223850_223917_224046_224055_224067_224084_224118_224202; plus_cv=1::m:7.94e+147; BDICON=10294984.98; BDSFRCVID_BFESS=qC0OJeC62rhqUQRDg6eXqa0DFbOuS-JTH6f3RImXqHw54sMDrKcmEG0PQx8g0K4Moys6ogKK0mOTHv-F_2uxOjjg8UtVJeC6EG0Ptf8g0f5; H_BDCLCKID_SF_BFESS=tJufoCLXtCvbfP0k2-Otq4tHeN7W-URZ56bHWh0MalvrflbVQ4RKKtoQQ-DHBMnQJKrnKUT13Rr8jCOC2l3F-R_F3xb4Qx643bRTLU7GHRvKfj6S5xTmhP-UyN3LWh37Je3lMKoaMp78jR093JO4y4Ldj4oxJpOJ5JbMopCafD_KMIDCejL3-RJH-xQ0KnLXKKOLVbcgJp7ketn4hUt2hfPm54OA0qOn-CCjKpL-WhvSMno2QhrdQf4WWb3ebTJr32Qr-JONLlrpsIJM5hnlqtPX5ec7-f6TaKviaKJEBMb1MlvDBT5h2M4qMxtOLR3pWDTm_q5TtUJMeCnTDMFhe6jXjNLqq6_sKjAX3JjV5PK_Hn7zen7m5M4pbq7H2M-jam3dLqbmLUjNqJDxQMDKyUPjjU5n0pcr3mOfhUJb-IOdspcs34bp0fCkQN3T-pRPHC3HL66dbqrmDn3oyT3VXp0nj4Rly5jtMgOBBJ0yQ4b4OR5JjxonDh83bG7MJUutfJuH_KDKfCD3H48k-4QEbbQH-UnLq-Rw22OZ04n-ah02Dqv35xOx0h_7KfLj0UKHW23Q_bom3UTdsq76Wh35K5tTQP6rLtJ4Lmo4KKJxbU7lKJv45Dc15xCrhUJiB5OLBan7_qvIXKohJh7FM4tW3J0ZyxomtfQxtNRJ0DnjtpChbC8GD68bD5OBeU_XhPcKaKbyWJ3b2PK_Hn7zenQTDM4pbt-qJJj3-GTIbqbjJJ5iqJDxQMjDXnL9qt6nBT5htarAWxnhWP0hM-OEQb5v-PukQN3TQRkO5bRi_p6OM48-Dn3oyT3VXp0n5mcly5jtMgOBBJ0yQ4b4OR5JjxonDh83bG7MJPKtfD7H3KC-tKDMhfK; delPer=0; BD_CK_SAM=1; BA_HECTOR=2081050ka12h840g2gak8lvu1hf705v17; H_PS_645EC=a8cbKXziWYQ6sY5dMoUGRwsasuZFEAf6LWAu5rZCybQ6GI3%2B5StYb7%2Fy0n8; COOKIE_SESSION=9503_2_9_9_12_21_1_0_9_9_1_7_151379_0_0_0_1660115890_1659510667_1660125384%7C9%239860820_120_1659510566%7C9; rsv_i=c5daGzVjCunJIh0YKcUcHkD3iBiP1uYp3Yt8l6DiYc7%2F4U9hHSGOxs%2BWQiytpJbd20CruxQDN8Pl%2FBkHlD3v%2BXwpck2%2Fb4E; H_WISE_SIDS_BFESS=107314_110085_131862_176399_180636_188748_196428_204902_208721_209568_210305_210323_211433_211985_212296_212740_212869_213044_213351_214793_215730_216770_216846_217167_217439_218458_218549_218597_219451_219558_219723_219889_219942_219946_220071_220315_220334_220345_220386_220603_220663_221007_221016_221119_221120_221370_221410_221501_221698_221798_221825_221872_221923_222002_222136_222272_222298_222352_222389_222397_222522_222528_222616_222617_222619_222778_222780_222844_222861_223042_223064_223111_223138_223220_223238_223253_223296_223477_223596_223672_223729_223768_223780_223783_223826_223850_223917_224046_224055_224067_224084_224118_224202; plus_lsv=e9e1d7eaf5c62da9; SE_LAUNCH=5%3A27668756_0%3A27668756; BDSVRTM=81; MSA_WH=558_888; MSA_PBT=96; MSA_ZOOM=1000; MSA_PHY_WH=1116_1776; POLYFILL=0',
    }
    resp = requests.get(
        'https://www.baidu.com/from=844b/s',
        params={
            'word': word,
            'sa': 'tb',
            'ts': '5431715',
            't_kt': '0',
            'ie': 'utf-8',
            'rsv_t': '214fnSsdvmqfBfbKGDsoa%2FCoopjjcmQzY0gJSu7HO06aISOLpwSm0%2FOesg',
            'ms': '1',
            'rsv_pq': '8248985013208670914',
            'rqlang': 'zh',
            'oq': word,
        },
        headers=headers,
    )
    logger.info(f'url={resp.url}||finished request')
    if resp.status_code != 200:
        return [], f'url={resp.url}||status_code={resp.status_code}||http error'
    html_doc = resp.content.decode('utf8')
    return html_doc, ''


def _get(word: str) -> Tuple[str, str]:
    encode_word = parse.quote(word)
    # cmd = f"curl -Lv 'https://www.baidu.com/from=844b/s?word={encode_word}&sa=tb&ts=5431715&t_kt=0&ie=utf-8&rsv_t=214fnSsdvmqfBfbKGDsoa%252FCoopjjcmQzY0gJSu7HO06aISOLpwSm0%252FOesg&ms=1&rsv_pq=8248985013208670914&gpc=&ss=&rqlang=zh&oq={encode_word}' -H 'Cookie: wpr=0; BDICON=10294984.98; PSTM=1592374173; BIDUPSID=D06D2C138A5A78CF4992B441994D1787; __yjs_duid=1_c333b26cef54dd06de9d1a50e67d017e1620725024700; BAIDUID=C8AFED5ABC397F518A007AC7F65D5635:SL=0:NR=10:FG=1; BDSFRCVID=qC0OJeC62rhqUQRDg6eXqa0DFbOuS-JTH6f3RImXqHw54sMDrKcmEG0PQx8g0K4Moys6ogKK0mOTHv-F_2uxOjjg8UtVJeC6EG0Ptf8g0f5; H_BDCLCKID_SF=tJufoCLXtCvbfP0k2-Otq4tHeN7W-URZ56bHWh0MalvrflbVQ4RKKtoQQ-DHBMnQJKrnKUT13Rr8jCOC2l3F-R_F3xb4Qx643bRTLU7GHRvKfj6S5xTmhP-UyN3LWh37Je3lMKoaMp78jR093JO4y4Ldj4oxJpOJ5JbMopCafD_KMIDCejL3-RJH-xQ0KnLXKKOLVbcgJp7ketn4hUt2hfPm54OA0qOn-CCjKpL-WhvSMno2QhrdQf4WWb3ebTJr32Qr-JONLlrpsIJM5hnlqtPX5ec7-f6TaKviaKJEBMb1MlvDBT5h2M4qMxtOLR3pWDTm_q5TtUJMeCnTDMFhe6jXjNLqq6_sKjAX3JjV5PK_Hn7zen7m5M4pbq7H2M-jam3dLqbmLUjNqJDxQMDKyUPjjU5n0pcr3mOfhUJb-IOdspcs34bp0fCkQN3T-pRPHC3HL66dbqrmDn3oyT3VXp0nj4Rly5jtMgOBBJ0yQ4b4OR5JjxonDh83bG7MJUutfJuH_KDKfCD3H48k-4QEbbQH-UnLq-Rw22OZ04n-ah02Dqv35xOx0h_7KfLj0UKHW23Q_bom3UTdsq76Wh35K5tTQP6rLtJ4Lmo4KKJxbU7lKJv45Dc15xCrhUJiB5OLBan7_qvIXKohJh7FM4tW3J0ZyxomtfQxtNRJ0DnjtpChbC8GD68bD5OBeU_XhPcKaKbyWJ3b2PK_Hn7zenQTDM4pbt-qJJj3-GTIbqbjJJ5iqJDxQMjDXnL9qt6nBT5htarAWxnhWP0hM-OEQb5v-PukQN3TQRkO5bRi_p6OM48-Dn3oyT3VXp0n5mcly5jtMgOBBJ0yQ4b4OR5JjxonDh83bG7MJPKtfD7H3KC-tKDMhfK; BCLID_BFESS=8834056595211287241; BDORZ=B490B5EBF6F3CD402E515D22BCDA1598; BDSFRCVID_BFESS=qC0OJeC62rhqUQRDg6eXqa0DFbOuS-JTH6f3RImXqHw54sMDrKcmEG0PQx8g0K4Moys6ogKK0mOTHv-F_2uxOjjg8UtVJeC6EG0Ptf8g0f5; H_BDCLCKID_SF_BFESS=tJufoCLXtCvbfP0k2-Otq4tHeN7W-URZ56bHWh0MalvrflbVQ4RKKtoQQ-DHBMnQJKrnKUT13Rr8jCOC2l3F-R_F3xb4Qx643bRTLU7GHRvKfj6S5xTmhP-UyN3LWh37Je3lMKoaMp78jR093JO4y4Ldj4oxJpOJ5JbMopCafD_KMIDCejL3-RJH-xQ0KnLXKKOLVbcgJp7ketn4hUt2hfPm54OA0qOn-CCjKpL-WhvSMno2QhrdQf4WWb3ebTJr32Qr-JONLlrpsIJM5hnlqtPX5ec7-f6TaKviaKJEBMb1MlvDBT5h2M4qMxtOLR3pWDTm_q5TtUJMeCnTDMFhe6jXjNLqq6_sKjAX3JjV5PK_Hn7zen7m5M4pbq7H2M-jam3dLqbmLUjNqJDxQMDKyUPjjU5n0pcr3mOfhUJb-IOdspcs34bp0fCkQN3T-pRPHC3HL66dbqrmDn3oyT3VXp0nj4Rly5jtMgOBBJ0yQ4b4OR5JjxonDh83bG7MJUutfJuH_KDKfCD3H48k-4QEbbQH-UnLq-Rw22OZ04n-ah02Dqv35xOx0h_7KfLj0UKHW23Q_bom3UTdsq76Wh35K5tTQP6rLtJ4Lmo4KKJxbU7lKJv45Dc15xCrhUJiB5OLBan7_qvIXKohJh7FM4tW3J0ZyxomtfQxtNRJ0DnjtpChbC8GD68bD5OBeU_XhPcKaKbyWJ3b2PK_Hn7zenQTDM4pbt-qJJj3-GTIbqbjJJ5iqJDxQMjDXnL9qt6nBT5htarAWxnhWP0hM-OEQb5v-PukQN3TQRkO5bRi_p6OM48-Dn3oyT3VXp0n5mcly5jtMgOBBJ0yQ4b4OR5JjxonDh83bG7MJPKtfD7H3KC-tKDMhfK; delPer=0; BA_HECTOR=2081050ka12h840g2gak8lvu1hf705v17; rsv_i=c5daGzVjCunJIh0YKcUcHkD3iBiP1uYp3Yt8l6DiYc7%2F4U9hHSGOxs%2BWQiytpJbd20CruxQDN8Pl%2FBkHlD3v%2BXwpck2%2Fb4E; SE_LAUNCH=5%3A27668756_0%3A27668756; H_WISE_SIDS=107314_110085_131862_176399_180636_188748_196428_204902_208721_209568_210305_210323_211433_211985_212296_212740_212869_213044_213351_214793_215730_216770_216846_217167_217439_218458_218549_218597_219451_219558_219723_219889_219942_219946_220071_220315_220334_220345_220386_220603_220663_221007_221119_221120_221370_221410_221501_221698_221798_221825_221872_221923_222002_222136_222272_222298_222352_222389_222397_222522_222528_222616_222617_222619_222778_222780_222844_222861_223042_223064_223111_223138_223220_223238_223253_223296_223477_223596_223672_223729_223768_223780_223783_223826_223850_223917_224046_224055_224067_224084_224118_224202; H_WISE_SIDS_BFESS=107314_110085_131862_176399_180636_188748_196428_204902_208721_209568_210305_210323_211433_211985_212296_212740_212869_213044_213351_214793_215730_216770_216846_217167_217439_218458_218549_218597_219451_219558_219723_219889_219942_219946_220071_220315_220334_220345_220386_220603_220663_221007_221119_221120_221370_221410_221501_221698_221798_221825_221872_221923_222002_222136_222272_222298_222352_222389_222397_222522_222528_222616_222617_222619_222778_222780_222844_222861_223042_223064_223111_223138_223220_223238_223253_223296_223477_223596_223672_223729_223768_223780_223783_223826_223850_223917_224046_224055_224067_224084_224118_224202; kleck=b909da947c317accf342851dd61e84e5; BAIDUID_BFESS=ED470E97B5CF39CBDC8377200957B5CA:FG=1; MSA_WH=558_888; MSA_PBT=96; COOKIE_SESSION=0_0_0_0_0_0_0_0_0_0_0_0_0_1660136647%7C1%230_0_0_0_0_0_0_0_1660136647%7C1; MSA_PHY_WH=1116_1776; POLYFILL=0; BDSVRTM=60; PSINO=2; MSA_ZOOM=889; __bsi=8110822285151770105_00_43_R_R_17_0303_c02f_Y' -H 'User-Agent: Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Mobile Safari/537.36'"
    cmd = f"""curl 'https://www.baidu.com/ssid=8a3cb4f3b6ee333339393e94/from=844b/s?word={encode_word}&sa=tb&ts=2369974&t_kt=0&ie=utf-8&rsv_t=fb291vE4yqD6LSKnIStLGEIF9ueFYtoiLW%252FspwhS2a%252FWnivLd1qFOPd%252FtA&ms=1&rsv_pq=11207813075897722342&gpc=&sugid=170048185237130&ss=100&rqlang=zh&rsv_sug4=3076&inputT=1255&oq={encode_word}' \
  -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9' \
  -H 'Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,ja;q=0.7' \
  -H 'Connection: keep-alive' \
  -H 'Cookie: BDICON=10294984.98; wpr=0; PSTM=1573118650; BIDUPSID=27BE6C62390A8CB7C9E672456E197D59; __yjs_duid=1_13d37e267355188f602a0cb208c8f31e1621685932151; BAIDUID=21D3822E6436CD502077A2219813FCDB:SL=0:NR=10:FG=1; BDUSS=RFaH5ETX5OblN1VWp6cEJQVHRyb3ExZVZCWWl4dm9sTGRBWjhiOUwxNmFaZnRpRVFBQUFBJCQAAAAAAAAAAAEAAACKPD6UtPO27jMzOTkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJrY02Ka2NNibU; SIGNIN_UC=70a2711cf1d3d9b1a82d2f87d633bd8a04080631644lnsICEFN1HmyS5ySw%2FnlZKMlw7Y8WIlfMjVbXOCP2n7ZXHBKShahJyerE0XfP2eSpan6VJeKxcOD6wWgK4POl06QDFTryn3goUGWFB7C0B82bU5wt%2FNXAG0a9AUxrnRN9FiuGNsqH0Lf8xaABGEEF18nHhf6HJcjtUg%2BWg7tLuxQOA1WsS%2FDG%2BEYGLUCQUhWTDH6NvWyO1qKYSbWt%2B0uzRBX3qveoVmUeJ9dqaJvV5Z9Z%2FyXOScozq4UK5eeVEvn2AOr0hn1jZwNI73EZuWconNzcvzY4q0%2FfojWCpzP4ts%3D76533537410071466927003039893956; BDUSS_BFESS=RFaH5ETX5OblN1VWp6cEJQVHRyb3ExZVZCWWl4dm9sTGRBWjhiOUwxNmFaZnRpRVFBQUFBJCQAAAAAAAAAAAEAAACKPD6UtPO27jMzOTkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJrY02Ka2NNibU; BDICON=10294984.98; BDSFRCVID=RUPOJexroG0meXjDYoggKwWaCgKKvV3TDYLEOwXPsp3LGJLVcKvVEG0Pt8lgCZu-2ZlgogKK0mOTHv8F_2uxOjjg8UtVJeC6EG0Ptf8g0M5; H_BDCLCKID_SF=tR30WJbHMTrDHJTg5DTjhPrMM-DJWMT-MTryKKJs54JKshQnDMOv5p-_LUbjLbvkJGnRh4oNBUJtjJjYhfO45DuZyxomtfQxtNRJQKDE5p5hKq5S5-OobUPUDMc9LUvqfgcdot5yBbc8eIna5hjkbfJBQttjQn3hfIkj2CKLtK8ahK-Rj603K-FbbfkXKR5--DTeLPbHKbP_DR5meToijM4pbt-qJfo3-b70WqbJtbcROP35-fbJyP_DQh5nBT5KabndaUnEWtcPoJRg-qtWyMtkQN3TWUuO5bRiLRo4JlnaDn3oyT3VXp0n5G7ly5jtMgOBBJ0yQ4b4OR5JjxonDh83bG7MJPKtfJueoCDhfII3qbjnMtjE-n8XMfc-etJXfK3bah7F5l8-hRRMhTO_-U04M4T0BbbUKm7Mah6lbDQxOKQphTtby5_Z-triXJLHLCQ4LRoN3KJmh4P9bT3v5Dunh2c02-biWbRL2MbdbDnP_IoG2Mn8M4bb3qOpBtQmJeTxoUJ25DnJhbLGe6Dbe55XjH-s5-70KK0X3RRVM45_KROvhjRajl8gyxoObtRxtIj-hncgyR7JShv63PQTbUPU5RDeLU3kBgTAhpPbtnvVEjCCMpjjynKZQttjQn0OaIvmhtKEtfcSen7TyU42hf47yhDO0q4Hb6b9BJcjfU5MSlcNLTjpQT8r5MDOK5OuJRLq_KPKtDK5bnoRq45HMt00qxby26nNQGR9aJ5y-J7nhb6NW-6UWt4sbPRfL-om523iLfLbQpbZ8h5O5p7mKnOyX-JZWp52W5cpKl0MLP-WDb3JWR_VDlIjbUnMBMPjamOnaPLy3fAKftnOM46JehL3346-35543bRTLnLy5KJYMDcnK4-XDTcXDfK; BDSFRCVID_BFESS=RUPOJexroG0meXjDYoggKwWaCgKKvV3TDYLEOwXPsp3LGJLVcKvVEG0Pt8lgCZu-2ZlgogKK0mOTHv8F_2uxOjjg8UtVJeC6EG0Ptf8g0M5; H_BDCLCKID_SF_BFESS=tR30WJbHMTrDHJTg5DTjhPrMM-DJWMT-MTryKKJs54JKshQnDMOv5p-_LUbjLbvkJGnRh4oNBUJtjJjYhfO45DuZyxomtfQxtNRJQKDE5p5hKq5S5-OobUPUDMc9LUvqfgcdot5yBbc8eIna5hjkbfJBQttjQn3hfIkj2CKLtK8ahK-Rj603K-FbbfkXKR5--DTeLPbHKbP_DR5meToijM4pbt-qJfo3-b70WqbJtbcROP35-fbJyP_DQh5nBT5KabndaUnEWtcPoJRg-qtWyMtkQN3TWUuO5bRiLRo4JlnaDn3oyT3VXp0n5G7ly5jtMgOBBJ0yQ4b4OR5JjxonDh83bG7MJPKtfJueoCDhfII3qbjnMtjE-n8XMfc-etJXfK3bah7F5l8-hRRMhTO_-U04M4T0BbbUKm7Mah6lbDQxOKQphTtby5_Z-triXJLHLCQ4LRoN3KJmh4P9bT3v5Dunh2c02-biWbRL2MbdbDnP_IoG2Mn8M4bb3qOpBtQmJeTxoUJ25DnJhbLGe6Dbe55XjH-s5-70KK0X3RRVM45_KROvhjRajl8gyxoObtRxtIj-hncgyR7JShv63PQTbUPU5RDeLU3kBgTAhpPbtnvVEjCCMpjjynKZQttjQn0OaIvmhtKEtfcSen7TyU42hf47yhDO0q4Hb6b9BJcjfU5MSlcNLTjpQT8r5MDOK5OuJRLq_KPKtDK5bnoRq45HMt00qxby26nNQGR9aJ5y-J7nhb6NW-6UWt4sbPRfL-om523iLfLbQpbZ8h5O5p7mKnOyX-JZWp52W5cpKl0MLP-WDb3JWR_VDlIjbUnMBMPjamOnaPLy3fAKftnOM46JehL3346-35543bRTLnLy5KJYMDcnK4-XDTcXDfK; BDORZ=B490B5EBF6F3CD402E515D22BCDA1598; BDRCVFR[feWj1Vr5u3D]=mk3SLVN4HKm; delPer=1; BD_CK_SAM=1; BA_HECTOR=0k0k8ha4a1ak24250la0fbtj1hf7g1016; BD_UPN=143254; H_PS_645EC=94a9xmGfzx39bx4gghIIsF%2B0WN7gE%2Bx5PRb8duuIg2rP2vA3Uh6tFiFo2tHsHeBJ6jWt; H_WISE_SIDS=107320_110085_114551_131862_180636_194519_194530_196427_197471_204915_206122_208721_209568_210299_210323_211433_212296_212873_215727_216712_216714_216837_217167_217439_218452_218549_218597_219452_219581_219743_219888_219943_219946_220068_220315_220336_220345_220388_220602_220608_220662_220927_221007_221118_221120_221410_221501_221527_221608_221642_221698_221734_221797_221825_221872_221876_221879_221920_221958_222279_222299_222391_222396_222460_222499_222522_222615_222617_222619_222625_222780_222793_222861_222870_223064_223068_223109_223136_223164_223223_223238_223476_223555_223668_223688_223766_223776_223808_223824_223916_224049_224077_224084_224120_224156; rsv_i=f8263RMvVYc%2B39v%2BFltt69aMcJGtYrFiC7d%2F3CPF7z1q0SkSpQr6tGwb1lLqD2e9BccVKtyljiHQw9SYHb2eG2KQHQBUaNU; plus_lsv=e9e1d7eaf5c62da9; plus_cv=1::m:7.94e+147; SE_LAUNCH=5%3A27669026; BDPASSGATE=IlPT2AEptyoA_yiU4VK_3kIN8efRYvWAD43GSyRhR6WPfCaWmhH3BrUrWz0HSieXBDP6wZTXebZda5XKXlVXa_EqnBsZp5pQejncxvqOucPTKtB88bUs3rnIWCssoPLTpfIf-3YmEAMzY75KewPJpuo4ivKl73JKb1bMsFn2q_ruAlmiBFKJxHyYK767O-0APNu594rXnExKIUGhWe7sTT0agCMjCGQsawrfitY6C3D5rkoXGurSRv5a_WuCEW28BxSe1eyLzKeoEZMwvp1nVSwT9UiVfuy; POLYFILL=0; MSA_WH=414_896; FC_MODEL=0_0_0_0_5.15_0_0_0_0_0_10.85_0_2_3_2_5_0_0_1658667623%7C2%235.15_0_0_2_2_0_1658667623%7C2%230_ax_1_0_0_0_123_1658667623; COOKIE_SESSION=0_0_0_0_0_0_0_0_0_0_0_0_0_1660141618%7C1%230_0_0_0_0_0_0_0_1660141618%7C1; MSA_PHY_WH=828_1792; MSA_PBT=96; MSA_ZOOM=1000; BDSVRTM=66' \
  -H 'Referer: https://www.baidu.com/ssid=8a3cb4f3b6ee333339393e94/from=844b/s?word=%E6%96%B0%E7%96%86%E4%BA%BA%E5%8F%A3&sa=tb&ts=2341984&t_kt=0&ie=utf-8&rsv_t=615cXymSpSdHNyBF59N785oSThwR3M0gi9ABzp06HmqtwvjMShXnPYYFfw&ms=1&rsv_pq=10921162977047377310&gpc=&ss=100&rqlang=zh&rsv_sug4=2908&inputT=1384&oq=%E5%AE%81%E5%A4%8F%E4%BA%BA%E5%8F%A3' \
  -H 'Sec-Fetch-Dest: document' \
  -H 'Sec-Fetch-Mode: navigate' \
  -H 'Sec-Fetch-Site: same-origin' \
  -H 'Sec-Fetch-User: ?1' \
  -H 'Upgrade-Insecure-Requests: 1' \
  -H 'User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1' \
  --compressed"""
    # print(cmd)
    output = subprocess.getoutput(cmd)
    return output, ''


def query_gdp(area: Area) -> Tuple[List[GDPItem], str]:
    '''
    return gdp_list, err_str
        其中gdp_list格式为[util.data_source.validator.GDPItem]
    '''
    area_name = area.get_full_name()
    html_doc, err_str = _get(f'{area_name}gdp')
    if len(err_str) != 0:
        return [], err_str

    return parse_gdp_html(html_doc)


def query_population(area: Area) -> Tuple[List[PopulationItem], str]:
    '''
    return population_list, err_str
        其中population_list格式为[util.data_source.validator.PopulationItem]，人口单位为万
    '''
    area_name = area.get_full_name()
    html_doc, err_str = _get(f'{area_name}人口')
    if len(err_str) != 0:
        return [], err_str

    return parse_population_html(html_doc)


if __name__ == '__main__':
    # result_list, err_str = query_population('侯马')
    # print(result_list, err_str)
    area = Area(
        code='141081000000',
        name='侯马市',
        level=3,
        upper_level_name='临汾市',
        province_name='山西省',
        url='http://www.stats.gov.cn/tjsj/tjbz/tjyqhdmhcxhfdm/2018/14/10/141081.html',
    )
    result_list, err_str = query_gdp(area)
    print(result_list, err_str)
